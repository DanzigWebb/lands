<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="referrer" content="no-referrer">
	<title>Orders Manager Inventory</title>
	<link rel="stylesheet" href="css/bootstrap.min_1.css"><link rel="stylesheet" href="css/font-awesome.css"><link rel="stylesheet" href="css/all.css">
	<link rel="stylesheet" href="css/ekko-lightbox.css">
	<style>
	body{
				
			}
	.ekko-lightbox .modal-header {
    	padding: 10px;
	}
	.ekko-lightbox .modal-body {
    	padding: 0px;
    	text-align: center !important;
	}
	.alert{
		margin:25px;
	}
	.preloader{
	  width: 100px;
	  height: 100px;
	  border-radius: 100%;
	  position: relative;
	  margin: 0 auto;
	}

	/* LOADER 1 */

	.loader-1:before, .loader-1:after{
	  content: "";
	  position: absolute;
	  top: -10px;
	  left: -10px;
	  width: 100%;
	  height: 100%;
	  border-radius: 100%;
	  border: 10px solid transparent;
	  border-top-color: #3498db;
	}

	.loader-1:before{
	  z-index: 100;
	  animation: spin 1s infinite;
	}

	.loader-1:after{
	  border: 10px solid #ccc;
	}

	@keyframes spin{
	  0%{
	    -webkit-transform: rotate(0deg);
	    -ms-transform: rotate(0deg);
	    -o-transform: rotate(0deg);
	    transform: rotate(0deg);
	  }

	  100%{
	    -webkit-transform: rotate(360deg);
	    -ms-transform: rotate(360deg);
	    -o-transform: rotate(360deg);
	    transform: rotate(360deg);
	  }
	}

	form .preloader{
	    display:none;
	}
	form .preloader.show{
	    float: left;
	    display: block;
	    width:35px;
	    margin: 10px 0px 0px 15px;
	    height: 35px;
	}
	form.loading{
	  opacity: 0.5;
	}
	form.loading .preloader{
	  display:block;
	  position: absolute;
	  left: calc(50% - 50px);
	  top: calc(50% - 50px);
	}
	#submit-button{
		margin-top: 10px;
	}

	.new-sbm-btn{
		font-weight: bold;
    	margin-left: -5px;
    	border-radius: 0px;
    	cursor:pointer;
	}

	.force-hidden{
		display:none !important;
	}
	@media (min-width:480px)  {

		button.new-sbm-btn:before {
		    top: 0.5px;
		    left: -17px;
		    position: relative;
		    content: "\f07a";
		    font-family: Font Awesome\ 5 Free;
		    color: white;
		    background-color: #343a40;
		    padding: 0.87rem 1rem;
		    font-size: 1.25rem;
		    line-height: 1.5;
		}
	}
	img{
		cursor: pointer;
	}
	</style>
	<script>
	setTimeout(function(){
		location.reload();
	},30*60*1000)
	</script>
</head>

<body>
	<div class="container" style="max-width: 500px;">
	
	<form method="post" accept-charset="utf-8" role="form" action="/manager/inventory/buy/nst_thermopile_2x1?ref=3c0cd9bcd068"><div style="display:none;"><input type="hidden" name="_method" value="POST"></div>					<input type="hidden" name="fingerprint" id="fingerprint" value>
					<input type="hidden" name="aff_sub1" value>					<center><h3 class="title">COMPILA IL MODULO</h3></center><input type="hidden" name="source_id" id="source_id" value="3c0cd9bcd068">
<div class="form-group">
  <label>Nome e Cognome</label>
    <input type="text" name="name" class="form-control" placeholder="Inserisci Nome e Cognome" required="required">  </div>
<div class="form-group">
    <label>Telefono (Meglio Cellulare)</label>
    <input type="text" name="phone" class="form-control" placeholder="Inserisci il tuo numero di telefono" required="required" value></div>
<div class="form-group">
  <label>Indirizzo e n. civico</label>
  <input type="text" name="address" class="form-control" placeholder="ES. Via Aldo moro, 130" required="required" value></div>
<div class="form-row">
    <div class="form-group col-md-8">
          <label>Città</label>
          <input type="text" name="city" class="form-control" placeholder="ES. Milano" required="required" value>    </div>
    <div class="form-group col-md-4">
        <label>CAP</label>
        <input type="text" name="zipcode" class="form-control" placeholder="ES. 94112" required="required" value>    </div>                        
</div>

<div class="form-row offer-selection" data-images="[]" data-default-img="https://manager-uploads.s3.eu-central-1.amazonaws.com/upload/products/image/2979_b67df0d642398032ecf52103683abd09_1579692552.jpg">
    <div class="col-auto text-center d-flex align-items-center" data-toggle="lightbox">
      <img data-jslghtbx style="max-width:100%;max-height:80px;" src="img/2979_b67df0d642398032ecf52103683abd09_1579692552.jpg">
  </div>
  <div class="form-group col text-center">
        <span>Offerta attiva:</span>
    <h5>2 ThermoPile 99,90 €</h5>
    <select name="quantity" class="d-none" required="required"><option value="1" selected="selected">2 ThermoPile 99,90 €</option></select>      </div>
  </div><div class="form-group">
  <div class="text-center">
    <span style="
      color: black;
      padding: 4px;
      background: #ffc205;
      font-weight: bold;
      border-radius: 5px;
      ">&nbsp;<i class="fa fa-truck"></i> La spedizione è gratis! </span>
  </div>
</div>
 
<div class="form-group">
    <label>Note per il corriere</label>
    <input type="text" name="notes" class="form-control" rows="2" placeholder="ES. Citofonare al Sig. Rossi" value></div>
<div style="display:none">
{
	"noEmail": true,
	"google_api_key": "AIzaSyAgw8TKWoeg2zo2GQeeex_dikCA0Fic4nY",
	"gls": {
		"sede": "SM",
		"codiceCliente": 3350,
		"passwordCliente": "SM3350"
	}
}</div>				<div class="preloader loader-1"></div>
				<center>
				<div id="info-privacy"><small>Cliccando "Completa l'acquisto" confermi di aver preso visione <a href="http://advmarket.shop/privacy-policy" target="_blank">dell'informativa sulla privacy</a>.</small></div><button id="submit-button" class="btn btn-lg btn-warning new-sbm-btn" type="submit">Completa l'acquisto</button>				<!--img src="/manager/img/form-secure.jpg" style="max-width:250px;margin:10px"-->     
				</center>
			</form>	</div>
	<!-- Bootstrap core JavaScript-->
<script src="js/jquery-3.3.1.min_1.js"></script><script src="js/popper.min_1.js"></script><script src="js/bootstrap.js"></script>	<script src="js/fingerprint2.min.js"></script>
	<script src="js/ekko-lightbox.min.js"></script>
	<script>
	$(function(){
		parent.postMessage({privacyHtml: "<small>Cliccando \"{BUY_BUTTON_TEXT}\" confermi di aver preso visione <a href=\"http:\/\/advmarket.shop\/privacy-policy\" target=\"_blank\">dell'informativa sulla privacy<\/a>.<\/small>"},"*");

	    new Fingerprint2().get(function(result, components){
	      if(result)
	        $("#fingerprint").val(result);
	    });

	    if($(".alert")[0]){
	    	window.scroll(0,0);
	    	$(".alert").get(0).scrollIntoView();
	    	console.log("Scrolling to: ",$(".alert"),$(".alert").offset());
	    }

	    function multipleOptions(){
	    	$field = $("[name=quantity]");
            val = parseInt($field.val());
            console.log(val);
            if($(".extra_multiple_options")[0]){
            	elements = $(".extra_multiple_options.first-element");

            	console.log(elements);
            	$(".extra_multiple_options").not(".first-element").remove();

            	$.each(elements,function(){
            		$appendnext = $(this);
            		for(var i=1;i<=(val-1);i++){
            			$newel = $(this).clone().removeClass("first-element");
            			$newel.find(".extra_multiple_count").text(i+1);
            			$appendnext.after($newel);
            			$appendnext = $newel;
            		}
            	})
            }

            var parent = $field.closest('.offer-selection');
	    	var images = parent.data("images");
	    	var value = $field.val();

	    	if(images[value])
	    		parent.find("img").attr("src",images[value]);
	    	else
	    		parent.find("img").attr("src",parent.data("default-img"));
        
	    }

	    multipleOptions();
	    $("[name=quantity]").on('change',multipleOptions);

	    $(document.body).on('change','[name^=extra_options]',function(){
	    	var parent = $(this).closest('.extra_multiple_options');
	    	var images = parent.data("images");
	    	var value = $(this).val();

	    	if(images[value])
	    		parent.find(".multiple-option-img").removeClass("force-hidden").find("img").attr("src",images[value]);
	    	else
	    		parent.find(".multiple-option-img").addClass("force-hidden");

	    });

	    $("[name^=extra_options]").each(function(){
	    	$(this).change();
	    });

	    	    let lastSubmittedDataJSON = localStorage.getItem("lastSubmittedData");
	    let lastSubmittedData = JSON.parse(lastSubmittedDataJSON);

		for (const key in lastSubmittedData) {

			$el = $("input[type=text][name='"+key+"']");

			if($el.length == 1)
				$el.val(lastSubmittedData[key]);
		}
		
	});

	errors = JSON.parse('[]');
	if(Object.keys(errors).length>0){

		form = $("form")[0];
        last_error_element = false;
        for(var key in errors){
           error = errors[key];
           for(var k in error){
              message = error[k];
              break;
           }

           if($(form).find("[name="+key+"]").length>0){
              form_element = $(form).find("[name="+key+"]")[0];
              if(!$(form_element).closest(".form-group").find(".invalid-feedback")[0])
              	$(form_element).closest(".form-group").append('<div class="invalid-feedback"></div>'),

              $(form_element).closest(".form-group").find(".invalid-feedback").text(message);
              $(form_element).addClass('is-invalid');
              last_error_element = form_element;

           } else if(typeof message ==='string'){
              $flashMessage = $('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>'+message+'</div>');
              $flashMessage.prependTo(form).delay(5000).fadeOut(500, function() {
                        $(this).remove();
                    });

              $flashMessage.get(0).scrollIntoView({behavior: 'smooth'});
           } else
             console.log(message);
        }

        if(last_error_element)
          $(last_error_element).get(0).scrollIntoView({behavior: 'smooth'});

      	$("form").on("change",".is-invalid",function(e){ console.log(e,this);
		   $(this).removeClass("is-invalid");
		})
    }


    jQuery.fn.preventDoubleSubmission = function() {
	  $(this).on('submit',function(e){
	    var $form = $(this);

	    if ($form.data('submitted') === true) {
	      // Previously submitted - don't submit again
	      e.preventDefault();
	      console.log("submit blocked");
	    } else {
	    	$form.addClass("loading");
	    	// Mark it so that the next submit can be ignored

			let lastSubmittedData = {};

			$.each(['name','phone','address','city','zipcode','banana'],function(i,key){
			    $el = $("input[type=text][name='"+key+"']");

			    if($el.length==1){
			        lastSubmittedData[key] = $el.val();
			    }
			});

			localStorage.setItem("lastSubmittedData",JSON.stringify(lastSubmittedData));
	    	$form.data('submitted', true);
	    }
	  });

	  // Keep chainability
	  return this;
	};

	jQuery('form').preventDoubleSubmission();

			/*if(location.protocol!=='http:')
			location.href = 'http:' + window.location.href.substring(window.location.protocol.length);*/
	
	/*jQueryPhoneDetect = function(data){
		console.log(data,data.detection);
	};

	$.ajax({
	  url: "https://la8746.gways.net/init-actions?callback=jQueryPhoneDetect&cfg_sessionid=&cfg_undefined=IE%3Dedge%2Cchrome%3D1&cfg_viewport=width%3Ddevice-width%2Cinitial-scale%3D1%2C+maximum-scale%3D1&cfg_landing_id=49479&cfg_landing_name=ipho-contenuto-083&cfg_publish_date=2020-12-02 13:19:15&cfg_keyword=iphone_bid14&cfg_country=IT&cfg_pixel_type=URL&cfg_pixel_s2s=1&cfg_pixel_pub_id=401&cfg_private_browsing=0&cfg_dev=false&cfg_urlbase=https%3A%2F%2Fla8746.gways.net&cfg_ga_cid=&req_transaction_id=102f7d662bb8cadc83da4b4784252f&req_aff_id=8689&req_sub_id=&_=3625714858444",
	  dataType: "jsonp"
	});*/

	$(document).on('click', '[data-toggle="lightbox"]', function(event) {
        event.preventDefault();
        $(this).attr("href",$(this).find("img").attr("src"));
        sl = $(this).closest(".form-row").find("select").get(0);
		$(this).attr("data-title",sl.options[sl.selectedIndex].text).data("title",sl.options[sl.selectedIndex].text);
        $(this).ekkoLightbox({alwaysShowClose: true});
    });
	</script>
</body>

</html>
